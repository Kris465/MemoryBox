# Unicorn (Единорог)

## Парсриснг -> Перевод -> Заливка

**Содержание:**

1. [Знакомство](пара-слов-обо-мне-и-проекте)
2. [Как работают команды переводчиков](предпосылки-исчезающий-рынок)
3. [Структура приложения](структура-приложения)

### Пара слов обо мне и проекте.

Я, Leastrо, один из основателей маленького творческого объединения или команды перевода Инь-Ян.

[Наша группа вк](https://vk.com/yinyanmanga)

Чтобы заранее пресечь многие вопросы, я НЕ руковожу командой. Я лишь на правах старичка всеми силами помогаю чем могу. Начав изучать программирование и зная внутренюю кухню работы в команде я осознала, что могу во многом упростить и ускорить работу ребят. 

Благодаря передаче некоторых механических задач приложению мы смогли поднять процент ребят с 20 до 70.

### Предпосылки. Исчезающий рынок:

Вы когда-нибудь читали мангу? А веб-новеллу?
    
Если да, то вам будет интересно взглянуть на мой проект и узнать как все устроено в командах изнутри.

Комиксы не относятся к моему приложению, но скажу пару слов, отдавая дань своим истокам.
    
Сейчас на рынке несколько крупных команд с дикой текучкой и множество маленьких команд, срок жизни которых не превышает года - двух. Манга, манхва, маньхуа - не бизнес. 
    
Это и не удивительно, редкий человек станет заниматься убыточным хобби и вкалывать дополнительную смену за спасибо, причем зачастую требуются люди с высокой квалификацией.

    На каждом "проекте" обычно работает 4 человека:
    
    1. Переводчик

*переводит текст, знание иностранного обязательно, для английского это минимум B2*
    
    2. Редактор 
    
*редактирует перевод, знание русского обязательно. Ха-ха, я со своим высшим журналистским и парой написанных книг его не знаю на необходимом уровне...*
    
    3. Клиннер 
    
*чистит сканы, от текста и звуков. Дорисовать половину скана под каким-нибудь иероглифом - тривиальная задача*
    
    4. Тайпер 
    
*вставляет русский текст в баблы, рисует звуки. При общении с ними мне казалось, что они видят в сто раз больше цветов и имеют уникальное чувство прекрасного*
    
    5. (иногда бывает) Бета-ридер 
    
*Делает итоговую вычитку и слезно умоляет тайпера исправить чужие косяки*

В конце глав обычно помещается визитка с никами тех, кто работал над главой:
[Наши старые проекты](https://readmanga.live/list/person/yin___yang)

Я уже долгое время не занимаюсь мангой.

Мне стало на ней скучно (клин + тайп занимает в разы больше времени, чем перевод + редакт, поэтому некоторые из переведенных мною манг, возможно, публикуются до сих пор) 

    В новеллах нет графической составляющей, поэтому работа с ними и проще и сложнее одновременно. 

    - Нет опоры на картинку, уровень переводчика должен быть выше, как и редактора. А еще нишевая и специфическая для жанров терминология.

    + На проекте можно оставить только 2 человека, вместо 4-х. 

В последние несколько лет из-за улучшения автоперевода требования к навыкам переводчика выросли, а стоимость работы уменьшилась. Сейчас половина авторского листа стоит от 300 до 700 рублей в зависимости от языка и сложности проекта. Английский зачастую дешевле или вообще бесплатен из-за соотношения спроса и предолжения. А вот корейцы, китайцы и японцы всегда в цене.

Из моего переводческого опыта:
Перевести 150 объемных глав за два-три месяца - норма, но финансово - бессмысленно и безнадежно, потому что продавец пятерочки заработает столько же за месяц, имея при этом выходные.

Ха-ха, любимое хобби оно такое... Зато теперь я могу прочитать, перевести и найти грамматические ошибки в английском тексте любой сложности. 

Сейчас вы в недоумении, почему я все время ссылаюсь на деньги, это необходимо, чтобы вы не тратили время и силы на то, что может не выгореть, потому что после знакомства с моим кодом у вас закроется мысль: а чем я хуже? Почему бы мне самому не сделать тоже самое? Ососбенно, учитывая, что я написала код почти для всего цикла работы. Взять код, запустить и на пассиве получать бабки, боюсь это так не работает... 

Потому что: 
1. Наша команда работает уже не первый год и у нас есть уже сложившаяся аудитория, при этом даже нам приходится постоянно платить за рекламу и колобарации с другими командами. (Есть постоянные покупатели глав)
2. В нашей команде отсутствуют межличностные конфликты, выработанные нормативы работы и мы не принимаем в команду несовершеннолетних.
3. Командой руководит второй основатель, который никогда не сменялся. Глава постоянно держит руку на пульсе, изучает читательские предпочтения и тренды. Мы ведем более 300 проектов сейчас и среди них нет убыточных, а это титанический труд матерого и опытного руководителя. 

Если у вас нет руководителя, который готов работать полный день за идею, переводчиков китайского, корейского, японского и английского (знающих русский хотя бы на уровне ЕГЭ), готовых сутками перелапачивать сотни глав, то боюсь, банальный автоперевод яндекса аудиторию не впечатлит.

Но чем больше сообщество - больше общий пирог, поэтому если захочется попробовать себя: _**Добро пожаловать!**_

### Структура приложения.

Сама я переводчик и меня всегда бесило ползать по вебстранице или картинке с оригиналом и набирать в ворде текст.
Я владею слепым методом и скорость печати у меня неплоха. Но даже один жалкий авторский лист требует сил. 
    
Я решила первым делом написать парсер, который будет идти на веб-страницу грузить текст, прогонять его через яндекс-переводчик и красиво упаковывать все это в текстовый файл, чтобы мне не открывать ничего лишнего, сразу править русскую болванку автоперевода и тут же сверять с оригиналом.

    Приложение написано на Python.

Я всего год пишу код и он, несомненно, не идеален, много странного и необычного, я перечислю только важное:

    Структура выглядит так:
    main.py - файл запуска приложения

Не забудьте развернуть вертуальное окружение:

    python3 -m venv <path/to/venv>

Не забудьте использовать файл requirements.txt для загрузки [необходимых библиотек](https://ru.stackoverflow.com/questions/1126707/%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2-requirements-txt).

    директория domain содержит: 
        1. Класс Controller (управляющий задачами блок)
        2. file_tools (методы, которые и я импортирую везде для чтения и записи файлов)
        3. Класс Task (задача, которую необходимо выполнить контроллеру)

    пакет parser содержит:
        набор стратегий для разных сайтов

Если сайт уже знаком, а новелла новая, то он подберет по названию сайта нужную логику и подставит. Для знакомства лучше обратить внимание на EngStepper. Это логика подходит для сбора глав почти со всех англоязычных и некоторых китайских источников. Теги она подгружает из файла library.json

    директория translator содержит:
        1. Класс Translator, который отправляет запрос к API яндекса. 

Не забудьте обратиться к [документации яндекса](https://cloud.yandex.ru/ru/docs/translate/) и создать личный кабинет.

Так же изучить библиотеку [dotenv](https://pypi.org/project/python-dotenv/#getting-started). Как ее установить и спрятать в файл .env все ключи. Без правильной настройки код не сработает. Мой файл сейчас выглядит таким образом:

    # Для блока translator
    AOuth_token='...'
    folder_id='...'
    IAM_TOKEN='...'

    # Для базы данных
    user='...'
    password='...'
    host='...'
    database='...'

    # Для блока loader
    rulate_login='...'
    rulate_password='...'

Обязательно проверьте невидим ли этот файл для гита в файле .gitignore.

    2. Класс TrManager, который:
        Читает записанный парсером json файл. --> По данным из задачи выбирает нужные главы. --> Вызывает класс Translator, передает в него данные согласно квотам Яндекса. --> Записывает новый json файл с оригинальным текстом + перевод

К сожалению, разделение парсера, переводчика и загрузчика критично для приложения, потому что проблемы могут возникнуть на любом этапе. А по итоговому json файлу можно легко понять, нормально ли отработал каждый блок. Сайты все разные, у Яндекса тоже не всегда все благополучно: код может отработать на ура, а вот качество текста может не устроить. 

Типичные проблемы парсера: 
1. На сайте одну и туже главу поместили 47 раз и 46 из них скрыли от пользователя. 
2. Выкинули вообще в другую новеллу по ссылке на следующую главу.
3. Сбор глав был слишком быстрый и защита сайта заблочила по айпи на час или сутки. 
4. На какой-нибудь главе интернет-провайдер решил устроить передышку на пару секунд и текст не собрался.

Типичные проблемы Яндекса:
1. Слишком частые запросы, блок на час. (лучше не запускать на перевод больше 10 новелл за раз, у меня стоит слип на 1 секунду, больше 10 запросов в секунду не проходят по квотам Яндекса)
2. Вернуть пустую строку вместо перевода (обычно бывает между 17.00 и 20.00 по МСК)
3. Вернуть оригинальную строку вместо перевода (Если они не смогли правильно определить язык оригинала)

Типичные проблемы загрузчика на читалку:

1. [Рулейт](https://tl.rulate.ru/) упал и отдыхает.

        Директория user содержит:
            Класс UserMenu, консольное пользовательское меню для получения данных для задач.

Для отслеживания работы приложения я использую библиотеку [loguru](https://loguru.readthedocs.io/en/stable/api/logger.html). Легкая для освоения и приятная в использовании библиотека.

    Директория loader содержит:
        Класс ForRulate, который с помощью библиотеки Selenium автоматизирует заливку глав на сайт-читалку.

Внимательно изучите код, я настраивала его под работу команды, поэтому оно требует определенных прав в личном кабинете на сайте, к тому же он заливает только платные главы (что тоже следует прописать в найстройках новеллы на сайте).

Кстати, этот класс так же учитывает особенности сайта и режет главы на допустимые по размерам части.

А так же перед запуском неплохо изучить библиотеку [Selenium](https://pypi.org/project/selenium/)
